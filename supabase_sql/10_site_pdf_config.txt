-- Create the pdf_config table
CREATE TABLE public.pdf_config (
  id boolean PRIMARY KEY DEFAULT true, -- Ensures only one row
  logo_id uuid REFERENCES public.media_items(id) ON DELETE SET NULL,
  company_name text,
  contact_phone text,
  contact_email text,
  website text,
  address text,
  footer_text text,
  accent_color text, -- e.g., '#RRGGBB'
  updated_at timestamptz DEFAULT now() NOT NULL,
  CONSTRAINT single_row_check_pdf_config CHECK (id = true) -- Enforce single row
);

-- Enable Row Level Security
ALTER TABLE public.pdf_config ENABLE ROW LEVEL SECURITY;

-- Trigger for updated_at timestamp
-- Assumes trigger_set_timestamp function is created from 00_setup.txt
CREATE TRIGGER set_pdf_config_updated_at
BEFORE UPDATE ON public.pdf_config
FOR EACH ROW
EXECUTE FUNCTION public.trigger_set_timestamp();

-- Add Indexes
CREATE INDEX IF NOT EXISTS idx_pdf_config_logo_id ON public.pdf_config (logo_id);

-- Manually run this AFTER table creation to insert the single configuration row:
INSERT INTO public.pdf_config (id) VALUES (true) ON CONFLICT (id) DO NOTHING;